test:
  override:
    - echo "test"
checkout:
  post:
    - sed -i "s/%RESULT_SNS_TOPIC_ARN%/${RESULT_SNS_TOPIC_ARN}/g" ./make-request/index.js
    - sed -i "s/%FAILURE_SNS_TOPIC_ARN%/${FAILURE_SNS_TOPIC_ARN}/g" ./handle-result/index.js
    - sed -i "s/%COMPLETE_SNS_TOPIC_ARN%/${COMPLETE_SNS_TOPIC_ARN}/g" ./handle-result/index.js
    - sed -i "s|%SLACK_WEBHOOK_PATH%|${SLACK_WEBHOOK_PATH}|g" ./send-to-slack/index.js
    - cd zip sent-to-slack && ${CIRCLE_ARTIFACTS}/send-to-slack.zip *
deployment:
  prod:
    branch: master
    commands:
      - aws s3 sync ${CIRCLE_ARTIFACTS} s3://tegud-watch-code/ --delete
